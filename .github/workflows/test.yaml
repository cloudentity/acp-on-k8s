name: test

on:
  push:
    branches-ignore:
      - "master"
    tags-ignore:
      - "*"

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Setup Kubernetes
        uses: engineerd/setup-kind@v0.5.0
        with:
          version: "v0.10.0"
      - uses: azure/setup-helm@v1
        with:
          version: 3.5.4
        id: install
      - name: Deploy
        env: # Or as an environment variable
          DOCKER_USER: ${{ secrets.DOCKER_USER }}
          DOCKER_PWD: ${{ secrets.DOCKER_PWD }}
        run: make all
      - name: test
        run: make test-prepare test-web-smoke
      - name: test-clean
        run: make test-clean
        
